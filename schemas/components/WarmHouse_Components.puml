@startuml warmhouse containers diagram
!include ../assets/C4_templates/C4_Component.puml

title Система "Тёплый Дом", "Gateway для модулей" (C4 Components)

Boundary(main_system, "Система Тёплый Дом") {
    Boundary(service, "Gateway для модулей") {
        Boundary(pull_part, "pull-взаимодействие") {
            Component(command_srv, "Сервис отправки управляющих сигналов модулям умного дома")
            Component(module_adapter, "Адаптер к модулю")
            Component(control_sig_ctrl, "Контроллер управления модулями")
            Component(pull_data_ctrl, "Контроллер запроса данных у модуля")
            Component(pull_data_srv, "Сервис запроса данных у модуля")
        }
        Boundary(push_part, "push-взаимодействие") {
            Component(active_gather_ctrl, "Контроллер приема данных от модулей")
            Component(query_srv, "Сервис получения данных с модуля умного дома")
            Component(register_ctrl, "Контроллер регистрации модулей")
            Component(modules_reg_srv, "Сервис учёта подключенных модулей")
        }

        ComponentDb(routing_srv, "Репозиторий маршрутов до модулей умного дома")
    }
    System_Ext(module_srv, "Микросервис работы с модулем умного дома", "")
    SystemQueue_Ext(a, "", "")
}

Boundary(home, "Домохозяйство") {
    System_Ext(module, "Модуль умного дома", "")
}

Rel(module, register_ctrl, "")
Rel(module, active_gather_ctrl, "")
Rel(control_sig_ctrl, command_srv, "")
Rel(active_gather_ctrl, query_srv, "")
Rel(register_ctrl, modules_reg_srv, "")
Rel(module_srv, pull_data_ctrl, "")
Rel(pull_data_ctrl, pull_data_srv, "")
Rel(pull_data_srv, module_adapter, "")

Rel(module_adapter, module, "")

Rel(module_srv, control_sig_ctrl, "")

Rel(modules_reg_srv, routing_srv, "")
Rel(command_srv, module_adapter, "")
Rel(command_srv, routing_srv, "")


@enduml
